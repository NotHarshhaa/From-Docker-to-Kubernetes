---
title: Docker Compose
description: Learn about Docker Compose for defining and running multi-container applications
icon: 'lucide:layers'
---

## Docker Compose

Docker Compose is a tool for defining and running multi-container Docker applications. It uses a YAML file to configure application services, networks, and volumes.

## Key Concepts

::steps
### Services
- Individual containers
- Defined in docker-compose.yml
- Can scale independently
- Share networks and volumes

### Networks
- Automatic network creation
- Service discovery built-in
- Custom network configuration
- Isolated environments

### Volumes
- Persistent data storage
- Shared between services
- Named volumes
- Bind mounts support
::

## Docker Compose File

Basic structure of a `docker-compose.yml` file:

```yaml
version: '3.8'
services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./www:/usr/share/nginx/html
    depends_on:
      - db
  
  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: myapp
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
```

## Common Commands

```bash
# Start services
docker-compose up

# Start in detached mode
docker-compose up -d

# Stop services
docker-compose down

# View logs
docker-compose logs

# Scale service
docker-compose up -d --scale web=3

# List containers
docker-compose ps

# Execute command in service
docker-compose exec web sh
```

## Environment Variables

::alert{type="info"}
Docker Compose supports environment variables in multiple ways:
1. `.env` file in project directory
2. Shell environment variables
3. Environment file specified with `--env-file`
4. Environment section in compose file
::

Example `.env` file:
```bash
MYSQL_ROOT_PASSWORD=secret
MYSQL_DATABASE=myapp
NGINX_PORT=80
```

## Service Configuration

::steps
### Build Configuration
```yaml
services:
  app:
    build:
      context: ./app
      dockerfile: Dockerfile.dev
      args:
        ENV: development
```

### Network Configuration
```yaml
services:
  web:
    networks:
      - frontend
      - backend
networks:
  frontend:
  backend:
```

### Volume Configuration
```yaml
services:
  db:
    volumes:
      - db_data:/var/lib/mysql
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
```
::

## Advanced Features

### Health Checks
```yaml
services:
  web:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 1m30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

### Resource Limits
```yaml
services:
  app:
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
```

## Best Practices

::alert{type="warning"}
1. Use version control for compose files
2. Separate development and production configs
3. Use environment variables for secrets
4. Define service dependencies
5. Set resource limits
6. Use health checks
7. Name your volumes
::

## Development vs Production

::steps
### Development
- Volume mounts for code
- Debug ports exposed
- Development tools included
- Hot reload enabled
- Minimal resource limits

### Production
- Built images used
- Limited port exposure
- No source code mounting
- Resource limits set
- Health checks enabled
::

## Common Patterns

### Web Application Stack
```yaml
version: '3.8'
services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
  
  app:
    build: ./app
    environment:
      - NODE_ENV=production
    depends_on:
      - db
      - redis
  
  db:
    image: postgres:13
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

## Troubleshooting

::alert{type="info"}
Common issues and solutions:
1. Check service logs with `docker-compose logs`
2. Verify network connectivity
3. Validate environment variables
4. Check volume permissions
5. Review service dependencies
6. Inspect resource usage
::