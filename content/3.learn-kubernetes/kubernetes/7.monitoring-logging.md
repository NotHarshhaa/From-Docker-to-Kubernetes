---
title: Monitoring & Logging
description: Understanding Kubernetes monitoring, logging, and observability practices
icon: 'lucide:activity'
---

## Monitoring & Logging

Effective monitoring and logging are crucial for maintaining healthy Kubernetes clusters and applications.

## Monitoring Components

::steps
### Metrics Server
- Basic cluster metrics
- CPU and memory usage
- Pod and node metrics
- Horizontal Pod Autoscaling

### Prometheus
- Time-series database
- Metrics collection
- Query language (PromQL)
- Alert management

### Grafana
- Visualization platform
- Dashboard creation
- Metrics exploration
- Alert notification
::

## Basic Monitoring Setup

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
spec:
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
      - name: prometheus
        image: prom/prometheus:v2.30.3
        ports:
        - containerPort: 9090
```

## Resource Metrics

::steps
### Pod Metrics
```bash
kubectl top pod -n default
```

### Node Metrics
```bash
kubectl top node
```

### Custom Metrics
```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: app-metrics
spec:
  selector:
    matchLabels:
      app: myapp
  endpoints:
  - port: metrics
```
::

## Logging Architecture

::alert{type="info"}
Components of logging:
1. Container logs
2. Node-level logging
3. Cluster-level logging
4. Log aggregation
5. Log analysis
::

## Container Logging

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: counter
spec:
  containers:
  - name: count
    image: busybox
    args:
    - /bin/sh
    - -c
    - >
      i=0;
      while true;
      do
        echo "$i: $(date)";
        i=$((i+1));
        sleep 1;
      done
```

## Logging Solutions

::steps
### Elasticsearch
- Log storage
- Full-text search
- Analytics
- Visualization

### Fluentd
- Log collection
- Unified logging
- Multiple outputs
- Plugin architecture

### Kibana
- Log visualization
- Dashboard creation
- Log exploration
- Alert management
::

## EFK Stack Deployment

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elasticsearch
spec:
  serviceName: elasticsearch
  replicas: 3
  selector:
    matchLabels:
      app: elasticsearch
  template:
    metadata:
      labels:
        app: elasticsearch
    spec:
      containers:
      - name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:7.15.0
```

## Monitoring Best Practices

::alert{type="warning"}
1. Set appropriate resource limits
2. Configure alerts properly
3. Use persistent storage
4. Implement retention policies
5. Regular backup of metrics
6. Monitor critical components
::

## Alert Management

```yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: high-cpu-usage
spec:
  groups:
  - name: cpu
    rules:
    - alert: HighCPUUsage
      expr: container_cpu_usage_seconds_total > 0.9
      for: 5m
      labels:
        severity: warning
      annotations:
        description: High CPU usage detected
```

## Dashboards

::steps
### Metrics Dashboard
- Resource utilization
- Performance metrics
- Health status
- Alert overview

### Logging Dashboard
- Log patterns
- Error rates
- Application logs
- System logs
::

## Performance Monitoring

::steps
### Key Metrics
- CPU usage
- Memory consumption
- Network traffic
- Disk I/O
- Response times

### Service Level Indicators
- Availability
- Latency
- Error rate
- Throughput
- Saturation
::

## Log Management

### Log Aggregation
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd
spec:
  selector:
    matchLabels:
      name: fluentd
  template:
    metadata:
      labels:
        name: fluentd
    spec:
      containers:
      - name: fluentd
        image: fluent/fluentd:v1.13
        volumeMounts:
        - name: varlog
          mountPath: /var/log
      volumes:
      - name: varlog
        hostPath:
          path: /var/log
```

## Troubleshooting

::alert{type="info"}
Common monitoring issues:
1. Resource constraints
2. Storage problems
3. Network connectivity
4. Configuration errors
5. Data retention
::

## Advanced Topics

::steps
### Service Mesh Monitoring
- Istio metrics
- Traffic monitoring
- Service graphs
- Distributed tracing

### Custom Metrics
- Application metrics
- Business metrics
- External metrics
- Synthetic monitoring

### Automated Actions
- Auto-scaling
- Self-healing
- Capacity planning
- Performance optimization
::

## Best Practices Checklist

::alert{type="info"}
1. Monitor cluster health
2. Implement log rotation
3. Set up alerting
4. Use persistent storage
5. Regular backups
6. Monitor applications
7. Track resource usage
8. Implement security monitoring
9. Performance tracking
10. Capacity planning
::